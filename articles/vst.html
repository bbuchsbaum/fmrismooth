<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Variance–Stabilizing Transform (VST) for Rician Magnitude • fmrismooth</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Variance–Stabilizing Transform (VST) for Rician Magnitude">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmrismooth</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bilateral-lattice.html">Joint Bilateral Smoothing with a Permutohedral Lattice</a></li>
    <li><a class="dropdown-item" href="../articles/guided-filter.html">Edge-Preserving Guided Filtering (3D/4D)</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Getting Started with fmrismooth</a></li>
    <li><a class="dropdown-item" href="../articles/mppca.html">MP–PCA Denoising for fMRI</a></li>
    <li><a class="dropdown-item" href="../articles/robust-tv.html">Robust TV: Huber and Tukey Data Terms</a></li>
    <li><a class="dropdown-item" href="../articles/tv-denoising.html">Space–Time Total Variation Denoising</a></li>
    <li><a class="dropdown-item" href="../articles/vst.html">Variance–Stabilizing Transform (VST) for Rician Magnitude</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Variance–Stabilizing Transform (VST) for Rician Magnitude</h1>
                        <h4 data-toc-skip class="author">fmrismooth
authors</h4>
            
            <h4 data-toc-skip class="date">2025-08-28</h4>
      

      <div class="d-none name"><code>vst.Rmd</code></div>
    </div>

    
    
<p>Magnitude MR data follows a Rician distribution. At moderate SNR, the
noise variance depends on the underlying signal, which complicates
denoising methods designed for additive Gaussian noise. A simple
strategy is to apply a variance–stabilizing transform (VST), denoise
under a Gaussian assumption, then invert the transform.</p>
<div class="section level2">
<h2 id="forward-and-inverse-transforms">Forward and inverse transforms<a class="anchor" aria-label="anchor" href="#forward-and-inverse-transforms"></a>
</h2>
<p>The forward transform maps magnitude <code>x</code> to
<code>z = sqrt(max(x^2 - 2*sigma^2, 0))</code>. The inverse maps back
via <code>x = sqrt(max(z^2 + 2*sigma^2, 0))</code>. The parameter
<code>sigma</code> is the noise standard deviation in magnitude
units.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">100</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vst_forward.html">vst_forward</a></span><span class="op">(</span><span class="va">x</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">xi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vst_inverse.html">vst_inverse</a></span><span class="op">(</span><span class="va">z</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">xi</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wrapping-a-denoiser-how-to-use-with-this-package">Wrapping a denoiser (how to use with this package)<a class="anchor" aria-label="anchor" href="#wrapping-a-denoiser-how-to-use-with-this-package"></a>
</h2>
<p><code>vst_denoise(x, sigma, denoise_fun, ...)</code> applies the
forward transform, calls a denoiser, then inverts. The
<code>denoise_fun</code> can be any function in this package that
accepts the data as its first argument and returns an array of the same
shape. Extra arguments are forwarded via <code>...</code>.</p>
<p>The most convenient usage is to pass a function directly and supply
its parameters in <code>...</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">8</span>, <span class="fl">8</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">100</span>, dim <span class="op">=</span> <span class="va">d4</span><span class="op">)</span></span>
<span><span class="va">noisy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">clean</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">d4</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, dim <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># Rician-like</span></span>
<span></span>
<span><span class="co"># Use joint bilateral in the Gaussianized (VST) domain</span></span>
<span><span class="va">out_bilat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vst_denoise.html">vst_denoise</a></span><span class="op">(</span></span>
<span>  <span class="va">noisy</span>,</span>
<span>  denoise_fun <span class="op">=</span> <span class="va">bilat_lattice4d</span>,</span>
<span>  sigma_sp <span class="op">=</span> <span class="fl">2.0</span>, sigma_t <span class="op">=</span> <span class="fl">0.4</span>, sigma_r <span class="op">=</span> <span class="fl">8</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or use space–time TV in the VST domain</span></span>
<span><span class="va">out_tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vst_denoise.html">vst_denoise</a></span><span class="op">(</span></span>
<span>  <span class="va">noisy</span>,</span>
<span>  denoise_fun <span class="op">=</span> <span class="va">tv_denoise4d</span>,</span>
<span>  lambda_s <span class="op">=</span> <span class="fl">0.6</span>, lambda_t <span class="op">=</span> <span class="fl">0.2</span>, iters <span class="op">=</span> <span class="fl">20L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>var_noisy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">noisy</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  var_bilat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out_bilat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  var_tv    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out_tv</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  var_noisy  var_bilat     var_tv </span></span>
<span><span class="co">#&gt; 3.97367690 0.03625491 0.20270265</span></span>
<span></span>
<span><span class="va">zmid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">d4</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>; <span class="va">tmid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">d4</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu">slice_df4d</span><span class="op">(</span><span class="va">noisy</span>, <span class="va">zmid</span>, <span class="va">tmid</span>, <span class="st">"noisy (magnitude)"</span><span class="op">)</span>,</span>
<span>  <span class="fu">slice_df4d</span><span class="op">(</span><span class="va">out_bilat</span>, <span class="va">zmid</span>, <span class="va">tmid</span>, <span class="st">"VST + bilat_lattice4d"</span><span class="op">)</span>,</span>
<span>  <span class="fu">slice_df4d</span><span class="op">(</span><span class="va">out_tv</span>, <span class="va">zmid</span>, <span class="va">tmid</span>, <span class="st">"VST + tv_denoise4d"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">viz</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">method</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"VST-based denoising: mid-slice/frame"</span>, x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="st">"intensity"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vst_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>You can also pass an anonymous function if you prefer to pre‑bind
certain arguments:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vst_denoise.html">vst_denoise</a></span><span class="op">(</span></span>
<span>  <span class="va">noisy</span>,</span>
<span>  denoise_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="../reference/bilat_lattice4d.html">bilat_lattice4d</a></span><span class="op">(</span><span class="va">z</span>, sigma_sp <span class="op">=</span> <span class="fl">2.5</span>, sigma_t <span class="op">=</span> <span class="fl">0.5</span>, sigma_r <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">out_custom</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  8  8  8 12</span></span></code></pre></div>
<div class="section level3">
<h3 id="using-with-pipelines">Using with pipelines<a class="anchor" aria-label="anchor" href="#using-with-pipelines"></a>
</h3>
<p>You can wrap end‑to‑end pipelines, but avoid configurations that
internally estimate a Rician noise sigma from the (VST‑transformed)
data. For example, prefer explicit parameters over auto‑parameter
estimation when wrapping pipelines:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># OK: wrap a pipeline you configure explicitly</span></span>
<span><span class="va">out_ok</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vst_denoise.html">vst_denoise</a></span><span class="op">(</span></span>
<span>  <span class="va">noisy</span>,</span>
<span>  denoise_fun <span class="op">=</span> <span class="va">bilat_lattice4d</span>,  <span class="co"># core smoother used in smooth_auto()</span></span>
<span>  sigma_sp <span class="op">=</span> <span class="fl">2.5</span>, sigma_t <span class="op">=</span> <span class="fl">0.5</span>, sigma_r <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Avoid: wrapping smooth_auto() with auto_params=TRUE will try to</span></span>
<span><span class="co"># estimate a Rician sigma on VST data. If you do wrap it, set auto_params=FALSE</span></span>
<span><span class="co"># and pass explicit parameters.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="d-usage">3D usage<a class="anchor" aria-label="anchor" href="#d-usage"></a>
</h3>
<p>For 3D volumes there is no temporal dimension to estimate
<code>sigma</code> from; you must supply it:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">100</span>, dim <span class="op">=</span> <span class="va">d3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">d3</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, dim <span class="op">=</span> <span class="va">d3</span><span class="op">)</span></span>
<span><span class="va">out3d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vst_denoise.html">vst_denoise</a></span><span class="op">(</span><span class="va">vol</span>, sigma <span class="op">=</span> <span class="fl">2.0</span>, denoise_fun <span class="op">=</span> <span class="va">bilat_lattice3d</span>, sigma_sp <span class="op">=</span> <span class="fl">2.0</span>, sigma_r <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">out3d</span><span class="op">)</span>, <span class="va">d3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># visualize 3D mid-slice</span></span>
<span><span class="va">zmid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">d3</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">viz3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">d3</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">d3</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">vol</span><span class="op">[</span>,,<span class="va">zmid</span><span class="op">]</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"noisy"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">d3</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">d3</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out3d</span><span class="op">[</span>,,<span class="va">zmid</span><span class="op">]</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"VST + bilat_lattice3d"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">viz3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">method</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"VST-based denoising (3D)"</span>, x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="st">"intensity"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vst_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="when-to-use-vst">When to use VST<a class="anchor" aria-label="anchor" href="#when-to-use-vst"></a>
</h3>
<p>VST is especially helpful when the noise level varies with signal
intensity (magnitude MR). It can make downstream parameter choices more
stable and bring the noise closer to additive Gaussian, which is what
bilateral, guided, TV and MP–PCA assume. For complex‑valued
reconstructions or already Gaussianized data, you may skip VST and
denoise directly.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Your Name.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
